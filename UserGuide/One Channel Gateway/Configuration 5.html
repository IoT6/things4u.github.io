<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>1-ch Gateway v4</title>
</head>

<body>
<h1 dir="ltr" id="docs-internal-guid-8ff340d2-c1c9-78f0-295a-5c5cba894701">1-Channel Gateway Configuration</h1>
<h2 dir="ltr">Introduction</h2>
<p dir="ltr">This is the 5th generation of software implementing LoRa gateway function on a platform consisting of an ESP8266 mcu and a sx1276 radio. Unlike the previous versions of the gateway, this version will listen for all available Spreading Factors on a single frequency. </p>
<p dir="ltr"><a href="../../HardwareGuide/Single-Channel-Gway/images/ComResult-1.jpg"><img src="../../HardwareGuide/Single-Channel-Gway/images/ComResult-1.jpg" alt="Comresult" width="600" height="450" hspace="10" vspace="10" /></a></p>
<h2 dir="ltr">Setting the configuration</h2>
<p dir="ltr">There are two major ways to set the configuration of the Gateway:</p>
<ol>
  <li>Set configuration parameters in ESP-sc-gway.h file</li>
  <li>Use the GUI&nbsp;to set parameters</li>
</ol>
<p>In order to avoid having to use both options, we try to make most settings availble on both interfaces. But in practise the .h file is used to make configuration changes that are more permanent and the user interface is used to set everyday parameters and things that change more often.</p>
<h2>&nbsp;</h2>
<h2>Editing the ESP-sc-gway.h file</h2>
<p>Most parameters that can be set are compile-time directives so that code is compiled or not based on the value of the directive in the ESP-sc-gateway.h file. This way, the code base can be kept small when functions are not used. Example: Support for Wifi Manager can be turned ON or OFF based on the setting of WIFIMANAGER in the ESP-sc-gway.h file.</p>
<p><code>#define WIFIMANAGER 0</code></p>
<p>By changing the definition to &quot;1&quot; the complete functionality to use Wifi Manager is included in the code and compiled. By using &quot;0&quot; all functions relating to this functionality is excluded from the gateway code.</p>
<p>Several parameters or compiler directives can be set in the .h file such as:</p>
<ul>
  <li><code>DEBUG 1; Initial value of the debug variable. </code></li>
  <li><code>_STRICT_CH 0; Leave this parameter on 0 unless you like to correct the frequency/sf set by the backend.</code></li>
  <li><code>_CAD</code></li>
  <li><code>STATISTICS 1; This parameter detemines whether or not the gateway will report statistics on its use. This like total messages received etc. will or will not be reported. If you set this parameter to 2, it will gather statistics on SF of messages received and report through the web interface.</code></li>
  <li><code>MAX_STAT&nbsp;20; Sets the number of lines in the web interface and records that are kept in memory of the last messages sucessfully received.</code></li>
</ul>
<ul>
  <li><code>WIFIMANAGER 0; Set to OFF by default. If you like to use WiFi manager, please set it to 1</code></li>
  <li><code>AP_NAME &quot;&lt;Name your gateway accesspoint&gt;&quot;;</code></li>
  <li><code>AP_PASSWD &quot;&lt;Your AccessPoint password&gt;&quot;;</code></li>
  <li><code>GATEWAYMGT 1;</code></li>
  <li><code>CFG_sx1276_radio; Let this one be defined in this version. The code will support sx1272 with probably minor modifications as well, but this has not been tested. </code></li>
  <li><code>CONFIGFILE &quot;/gwayConfig.txt&quot;</code>; This parameter tells us the name of the SPIFFS&nbsp;file used to store the configuration data.</li>
  <li><code>_LOCUDPPORT 1700</code></li>
  <li><code>_PULL_INTERVAL 30</code></li>
  <li><code>_STAT_INTERVAL 60</code></li>
  <li><code>_NTP_INTERVAL 3600</code></li>
</ul>
<ul>
  <li><code>_TTNPORT 1700</code></li>
  <li><code>_TTNSERVER &quot;router.eu.thethings.network&quot;</code></li>
</ul>
<ul>
  <li><code> _THINGPORT &lt;Your Port&gt;; Second backend server to send messages to. Leave undefined (comment #define out) if not used</code></li>
  <li><code>_THINGSERVER &quot;&lt;Your Backend DNS name&gt;&quot;; Second backend server to send messages to. Leave undefined (comment #define out) if not used</code></li>
</ul>
<ul>
  <li><code>GATEWAYNODE 0; </code></li>
  <li><code>#if GATEWAYNODE==1<br />
    #define _DEVADDR { 0x26, 0x01, 0x15, 0x3D }<br />
    #define _APPSKEY { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }<br />
    #define _NWKSKEY { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }<br />
    #define _SENSOR_INTERVAL 300<br />
    #endif</code></li>
</ul>
<ul>
  <li><code>_DESCRIPTION &quot;ESP Gateway&quot;</code></li>
  <li><code>_EMAIL &quot;&lt;Your Email&gt;&quot;</code></li>
  <li><code>_PLATFORM &quot;ESP8266&quot;</code></li>
  <li><code>_LAT &lt;Your LAT&gt;</code></li>
  <li><code>_LON &lt;Your LON&gt;</code></li>
  <li><code>_ALT &lt;Your ALT&gt;</code></li>
</ul>
<ul>
  <li><code>A_SERVER 1; Enable the webserver. Do not touch unless you know what you are doing</code></li>
  <li><code>A_REFRESH </code>&lt;seconds&gt;<code>&nbsp;&nbsp; //seconds between webpage refresh. 0 stops automatic refresh</code></li>
  <li><code>A_SERVERPORT 80</code></li>
  <li><code>A_MAXBUFSIZE 192</code></li>
  <li><code>_BAUDRATE 115200&nbsp;&nbsp;&nbsp;&nbsp; // Do not touch</code></li>
</ul>
<p>Most parameters starting with a &quot;_&quot; are parameters only. Please only change these if you know what you are doing. If the parameter contains a &quot;&lt;xxx&gt;&quot; it means that you have to put your own values there. After all, it does not make sense to put my email address or&nbsp;GPS data in your configuration.</p>
<p>The remaning part of the #define settings should be to include or not include certain parts of the code based on your own preference.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>Using the GUI to set&nbsp;parameters</h2>
<p>This part describes the GUI and how to set parameters. And of course my advise what parameters to set :-).</p>
<p>First of all: Determine the IP address of your single channel gateway. It can be that you set a fixed address in your router, but it could also be tat the router hands out addresses based on its own preference. Should you not know what addres is assigned by the router, remember that the single channel gateway will output the IP address and other important settings over USB during boot-up. So looking at the output on USB is a simple way to get the IP address (and it may be the only way for you).</p>
<p>When starting your GUI this is the first screen you will see.</p>
<p><img src="images/Configuration_gui_1.PNG" width="763" height="945" hspace="10" vspace="10" border="1" /></p>
<p>and the bottom half of the screen.</p>
<p><img src="images/Configuration_gui_2.PNG" width="760" height="947" hspace="10" vspace="10" border="1" /></p>
<p dir="ltr">So let's explain the GUI in more detail. The GUI has a few sections:</p>
<ul>
  <li>The title part which contains the time that the Gateways was started and ho long it is active.</li>
  <li>A few buttons with short-cut actions.</li>
  <li>Counter section</li>
  <li>Message History</li>
  <li>Gateway Settings. This section contains user changeable parts</li>
  <li>Wifi Config</li>
  <li>System Status</li>
</ul>
<h3 dir="ltr">Title Part</h3>
<p dir="ltr">The title part contains a little information about the Gateway such as the time it was activated and how long the gateway is active at the moment. It also contains the version of the software.</p>
<h3 dir="ltr">Buttons</h3>
<p dir="ltr">A few important buttons that activate pop-up screens showing other information that is not present on the main GUI screen.&nbsp;The LOG button for example opens a popup with a text editor containing all messages received by the gateway (.csv style). When a message isreceived the system will log its details in the SPIFFS filesystem. Because of the memory limitation of the ESP module, the last 100 files are saved on the chip&nbsp;and previous ones are deleted as soon as memory runs out. Still, it allows te used to anayse messages longs after these have been received by the gateway.</p>
<h3 dir="ltr">Counters</h3>
<p dir="ltr">This section contains the statistical info of all the messages that have been received by the gateway. It displays per spreading factor and per channel how many messages were received and display the amount of messages processed per hour.</p>
<h3 dir="ltr">Message History</h3>
<p dir="ltr">This section shows the last 20 messages received by the gateway. Of every message we record the time that it was received, the sebsir ID, the channel and the spreading factor used for sending the message etc.</p>
<h3 dir="ltr">Gateway Settings</h3>
<table width="90%" border="1">
  <tr>
    <td width="14%"><strong>Parameter</strong></td>
    <td width="12%"><strong>Allowed Values</strong></td>
    <td width="11%"><strong>Default Value</strong></td>
    <td width="63%"><strong>Description</strong></td>
  </tr>
  <tr>
    <td>CAD</td>
    <td>Yes or No</td>
    <td>Yes</td>
    <td>Set the Channel Activity Detection option. CAD allows the gateway to scan all Spreading factors in the frequency band</td>
  </tr>
  <tr>
    <td>HOP</td>
    <td>yes or NO</td>
    <td>NO</td>
    <td>Specify whether frequency hopping should be enabled. Frequency hopping will make the gateway work on more than one channel. This mode is highly experimental and does not work correctly. the user is strongly advised NOT to use HOP.</td>
  </tr>
  <tr>
    <td>SF</td>
    <td>7 to 12</td>
    <td>9</td>
    <td>Spreading Factor setting. If CAD is enabled (see above) the Spreading Factor is automatically set (AUTO)</td>
  </tr>
  <tr>
    <td>Channel</td>
    <td>0 to 9</td>
    <td>0</td>
    <td>The channel that the Gateway should work on. If HOP is set (see above) the frequency will shift between the first 3 well known frequencies</td>
  </tr>
  <tr>
    <td>Debug Level</td>
    <td>0 to 3</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
  </tr>
</table>
<p dir="ltr">&nbsp;</p>
<h3 dir="ltr">Wifi Config</h3>
<p dir="ltr">&nbsp;</p>
<h3 dir="ltr">System Status</h3>
<p dir="ltr">This section shows some system parameters. There is nothing to set here except when using an ESP8266 module, in this case the yser can set the system clock either to 80MHz or 160MHz.</p>
<p dir="ltr">&nbsp;</p>
<p dir="ltr">&nbsp;</p>
<p dir="ltr"><a href="../../HardwareGuide/Single-Channel-Gway/images/ComResult-1.jpg"></a></p>
<h3 dir="ltr">&nbsp;</h3>
<h3>Documentation</h3>
<p>There are (at least) two seperate documents that apply to this gateway:</p>
<ul>
  <li>The RFM95 datasheet made by HopeRF</li>
  <li><a href="https://www.google.fr/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;ved=0ahUKEwjOvbn4wNnUAhWGcRQKHTkuAjUQFggmMAA&amp;url=http%3A%2F%2Fwww.semtech.com%2Fimages%2Fdatasheet%2Fsx1276_77_78_79.pdf&amp;usg=AFQjCNFxkfmyuNwFCcaP_-dWGKdmskNKBQ&amp;cad=rja">The SX1276 datasheet made by Semtech</a> (this one is better than the HopeRF)</li>
  <li><a href="../LoRa documents/LoRa gateway to network server interface definition.pdf">Semtech ANNWS.01.2.1.W.SYS, 
  Gateway to Server Interface</a></li>
</ul>
<p>Datasheets for RFM95 and SX1276 should be the same. However, the HopeRF document dontains confusing information especially in the registers description are where RSSI for example (regaister 0x1B ?) is concerned.</p>
<h2 dir="ltr">&nbsp;</h2>
<h2>&nbsp;</h2>
<p dir="ltr">&nbsp;</p>
<h2 dir="ltr">RSSI</h2>
<p dir="ltr">RSSI stands for Received Signal Strength Indicator is is measured on the receiver to determine the signal quality of the sender. Normal RSSI can be measured any time at the receiver side by reading regaister 0x1B. The SX1276/RFM95 transceiver contains a special register 0x1A that contains theaverage packet RSSI information.</p>
<p dir="ltr">The RSSI function is used by CAD to determine if we have received a message. This is not as the RFM95 is designed, after all new messages might be received that are below the noise floor and this using RSSI is not the most reliable process.</p>
<p dir="ltr">The correct RSSI sample can be computed (according to the RFM95 manual para 4.2.5.3) by adding TS_RE + TS_RSSI</p>
<h2>DIO Pin-Out</h2>
<p>In the sx1276 datasheet we find that DIO 0 and DIO 1 are used to handle CAD interrupts and for message reception. So where we would only use dio0 in the version&nbsp; 3.x of the gateway, we now use dio0 AND dio1 in order to detect CAD  and RX Timeout evemts. This also means for users that the have to modify their gateway and set the pins correctly in the loraModem.h file.</p>
<h3>&nbsp;</h3>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><br />
</p>
</body>
</html>
